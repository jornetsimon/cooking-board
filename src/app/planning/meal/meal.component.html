<div fxLayout="column nowrap" fxLayoutAlign="start" class="container" #container>
	<div class="topper" fxLayoutAlign="center center">
		<div fxFlex="33%" class="relative">
			<span class="is-next" *ngIf="isNext$ | async">prochain</span>
		</div>
		<div
			fxFlex="1 0 33%"
			fxLayout="row-reverse"
			fxLayoutAlign="center"
			cdkDropList
			#dropListRef="cdkDropList"
			[cdkDropListData]="meal"
			[cdkDropListEnterPredicate]="canEnter"
			(cdkDropListDropped)="onDrop($event)"
			(cdkDropListEntered)="onEnter()"
		>
			<div
				class="day"
				[class.waiting-for-swap]="dragDropService.dragging$ | async"
				[class.cannot-drop]="cannotDropHere$ | async"
				[matTooltip]="(meal.date | date: 'EEEE dd MMMM') || 'ü§∑‚Äç‚ôÇÔ∏è'"
				cdkDrag
				[cdkDragData]="meal"
				(cdkDragStarted)="onDragStart()"
				(cdkDragEnded)="onDragEnd()"
				cdkDragPreviewClass="dragging"
				cdkDragPreviewContainer="parent"
			>
				{{ meal.date | date: 'EEEE' | titlecase }}&nbsp;
				<mat-icon *ngIf="meal.type === 'lunch'" style="color: #fff900">
					light_mode
				</mat-icon>
				<mat-icon *ngIf="meal.type === 'dinner'" style="color: #41658a">
					dark_mode
				</mat-icon>
			</div>
		</div>
		<div fxFlex="33%" fxLayoutAlign="end center" fxLayoutGap="10px" class="icons">
			<!--<div
				*ngIf="meal.jowRecipeId"
				fxLayoutAlign="center center"
				style="filter: brightness(1.3)"
			>
				<mat-icon svgIcon="jow"></mat-icon>
			</div>-->
			<div *ngIf="meal.extras?.croquettes">üê±</div>
		</div>
	</div>
	<mat-card
		class="meal"
		[class.empty]="!meal.name"
		[class.out-of-home]="!!meal.extras?.outOfHome"
		[class.has-jow-recipe]="!!meal.jowRecipe"
		[class.open]="editMode"
		[style.background-image]="
			meal.jowRecipe?.imageUrl
				? 'url(\'' + jowService.constructAssetUrl(meal.jowRecipe!.imageUrl) + '\')'
				: ''
		"
		[style.background-color]="meal.jowRecipe?.backgroundColor"
	>
		<div class="overlay"></div>
		<mat-card-header
			class="header"
			[class.has-jow-recipe]="meal?.jowRecipe"
			fxLayoutAlign="space-between center"
			(click)="toggleEdit()"
			ngxVibration="10"
			matRipple
		>
			<mat-card-title>
				<div fxLayout="column">
					<div>
						<ng-container *ngIf="meal?.name; else noMealTpl">
							{{ meal?.name }}
						</ng-container>
						<ng-template #noMealTpl>
							<div class="no-meal-title">Aucun plat</div>
						</ng-template>
					</div>
				</div>
			</mat-card-title>
			<div fxLayoutAlign="end center" fxLayoutGap="10px" fxFlex="noshrink" class="icons">
				<div *ngIf="meal.extras?.freezer">‚ùÑÔ∏è</div>
				<button mat-icon-button *ngIf="!meal.name">
					<mat-icon>add_circle</mat-icon>
				</button>
			</div>
		</mat-card-header>
		<mat-card-content>
			<div *ngIf="editMode" [@expandOnEnter] [@collapseOnLeave]>
				<div class="form-container">
					<cb-meal-form [meal]="meal" (mealSaved)="afterSave()"></cb-meal-form>
				</div>
			</div>
		</mat-card-content>
	</mat-card>
</div>
